parameters:
  JOB_PREFIX: ''
  JOB_CONTAINER: ''
  NPM_ARCH: ''
  VSCODE_ARCH: ''
  VSCODE_BUILD: true
  VSCODE_CIBUILD: true
  VSCODE_PUBLISH: true
  VSCODE_TEST: true

jobs:
  - job: ${{ parameters.JOB_PREFIX }}
    displayName: ${{ parameters.JOB_PREFIX }} (Compile)
    condition: and(succeeded(), eq('${{ parameters.VSCODE_BUILD }}', 'true'))
    container: ${{ parameters.JOB_CONTAINER }}
    variables:
      NPM_ARCH: ${{ parameters.NPM_ARCH }}
      VSCODE_ARCH: ${{ parameters.VSCODE_ARCH }}
      VSCODE_PUBLISH: ${{ parameters.VSCODE_PUBLISH }}
    steps:
      - template: product-compile-linux.yml

  - ${{ if eq(parameters.VSCODE_TEST, 'true') }}:
    - job: ${{ parameters.JOB_PREFIX }}BrowserTests
      displayName: ${{ parameters.JOB_PREFIX }} (Browser Test)
      dependsOn:
        - ${{ parameters.JOB_PREFIX }}
      container: ${{ parameters.JOB_CONTAINER }}
      variables:
        NPM_ARCH: ${{ parameters.NPM_ARCH }}
        VSCODE_ARCH: ${{ parameters.VSCODE_ARCH }}
      steps:
        - template: product-browser-tests-linux.yml

  - ${{ if eq(parameters.VSCODE_TEST, 'true') }}:
    - job: ${{ parameters.JOB_PREFIX }}ElectronTests
      displayName: ${{ parameters.JOB_PREFIX }} (Electron Test)
      dependsOn:
        - ${{ parameters.JOB_PREFIX }}
      container: ${{ parameters.JOB_CONTAINER }}
      variables:
        NPM_ARCH: ${{ parameters.NPM_ARCH }}
        VSCODE_ARCH: ${{ parameters.VSCODE_ARCH }}
      steps:
        - template: product-electron-tests-linux.yml

  - ${{ if eq(parameters.VSCODE_CIBUILD, 'false') }}:
    - job: ${{ parameters.JOB_PREFIX }}CodeSign
      displayName: ${{ parameters.JOB_PREFIX }} (CodeSign)
      dependsOn:
        - ${{ parameters.JOB_PREFIX }}
      container: ${{ parameters.JOB_CONTAINER }}
      variables:
        NPM_ARCH: ${{ parameters.NPM_ARCH }}
        VSCODE_ARCH: ${{ parameters.VSCODE_ARCH }}
      steps:
        - template: product-codesign-linux.yml
