parameters:
  JOB_PREFIX: ''
  JOB_CONTAINER: ''
  NPM_ARCH: ''
  VSCODE_ARCH: ''
  VSCODE_BUILD: true
  VSCODE_TEST: true

jobs:
  - job: ${{ parameters.JOB_PREFIX }}
    displayName: ${{ parameters.JOB_PREFIX }} (Compile)
    condition: and(succeeded(), eq('${{ parameters.VSCODE_BUILD }}', 'true'))
    container: ${{ parameters.JOB_CONTAINER }}
    variables:
      VSCODE_ARCH: ${{ parameters.VSCODE_ARCH }}
      NPM_ARCH: ${{ parameters.NPM_ARCH }}
    steps:
      - template: product-compile-linux.yml

  - job: ${{ parameters.JOB_PREFIX }}BrowserTests
    displayName: ${{ parameters.JOB_PREFIX }} (Browser Test)
    dependsOn:
      - ${{ parameters.JOB_PREFIX }}
    condition: and(succeeded(), eq('${{ parameters.VSCODE_TEST }}', 'true'))
    container: ${{ parameters.JOB_CONTAINER }}
    variables:
      VSCODE_ARCH: ${{ parameters.VSCODE_ARCH }}
      NPM_ARCH: ${{ parameters.NPM_ARCH }}
    steps:
      - template: product-browser-tests-linux.yml

  - job: ${{ parameters.JOB_PREFIX }}ElectronTests
    displayName: ${{ parameters.JOB_PREFIX }} (Electron Test)
    dependsOn:
      - ${{ parameters.JOB_PREFIX }}
    condition: and(succeeded(), eq('${{ parameters.VSCODE_TEST }}', 'true'))
    container: ${{ parameters.JOB_CONTAINER }}
    variables:
      VSCODE_ARCH: ${{ parameters.VSCODE_ARCH }}
      NPM_ARCH: ${{ parameters.NPM_ARCH }}
    steps:
      - template: product-electron-tests-linux.yml

  - ${{ if notIn(variables['Build.Reason'], 'IndividualCI', 'BatchedCI') }}:
    - job: ${{ parameters.JOB_PREFIX }}CodeSign
      displayName: ${{ parameters.JOB_PREFIX }} (CodeSign)
      dependsOn:
        - ${{ parameters.JOB_PREFIX }}
      condition: and(succeeded(), ne(variables['VSCODE_PUBLISH'], 'false'))
      container: ${{ parameters.JOB_CONTAINER }}
      variables:
        VSCODE_ARCH: ${{ parameters.VSCODE_ARCH }}
        NPM_ARCH: ${{ parameters.NPM_ARCH }}
      steps:
        - template: product-codesign-linux.yml
